let IMEMode="toHiragana";const itemsPerPage=25;let currentPage=1,data=[],filteredData=[];function loadContent(){return fetch("content-min.json").then((e=>e.json())).then((e=>{data=e,filteredData=data,loadPage(currentPage)}))}function getPageData(e){const t=25*(e-1),n=t+25;return filteredData.slice(t,n)}function loadPage(e){const t=generateContentHTML(getPageData(e));document.getElementById("container").innerHTML=t,updatePaginationControls(e),highlightFirstExerciseNumbers(),initializeNotes(),setInitialFuriganaState(),updateCounter()}function changePage(e){currentPage=e,""===document.getElementById("search").value.trim()?loadPage(currentPage):searchFunction(),updatePaginationControls(currentPage)}function generateContentHTML(e){const t=[];return e.forEach((e=>{let n=`<div class="number" id="${e.id}">`;e.counter&&(n+=`<span class="counter">${e.counter}</span>`),e.kanjiHeader&&(n+=`<span class="kanjiHeader">${e.kanjiHeader}</span>`),n+="</div>\n";let a='<div class="exercise">\n';e.kanjiHeader?a+=`<div class="sentence first elem_${e.kanjiHeader}">${e.exercise.sentence}</div>\n`:a+=`<div class="sentence">${e.exercise.sentence}</div>\n`,e.exercise.translation&&(a+=`<div class="translation">${e.exercise.translation}</div>\n`),e.exercise.notes&&e.exercise.notes.length>0&&(a+='<div class="notes">\n',e.exercise.notes.forEach((e=>{e=e.replace(/「(.*?)」/g,'「<span class="grammarPointsNote">$1</span>」'),a+=`<div class="note">${e}</div>\n`})),a+="</div>\n"),a+=`<a href="kanjistudy://grs?id=${e.id}">View in Kanji Study</a>`,a+=`<div class="exerciseNumber">${e.id}</div>\n`,a+="</div>\n",t.push(n+a)})),t.join("")}function updatePaginationControls(e){const t=Math.ceil(filteredData.length/25),n=document.getElementById("paginationControls");n.innerHTML="";for(let a=1;a<=t;a++){const t=document.createElement("button");t.textContent=a,a===e?(t.classList.add("active"),t.disabled=!0):t.disabled=!1,t.addEventListener("click",(()=>changePage(a))),n.appendChild(t)}}function setupPage(){highlightFirstExerciseNumbers(),updateCounter(),setInitialFuriganaState()}function highlightFirstExerciseNumbers(){const e=document.querySelectorAll(".exercise .sentence.first");for(const t of e){t.parentElement.previousElementSibling.classList.add("colouredNumber")}}window.onload=function(){loadContent().then(setupPage).catch((e=>{})),initializeEventListeners()};let exerciseTotalNumber=null;function updateCounter(){const e=filteredData.length;document.getElementById("filteredNumber").innerText=e}function initializeNotes(){const e=document.getElementsByClassName("notes");for(const t of e){const e=t.innerHTML;t.setAttribute("data-original-text",e),t.innerHTML="Show notes",t.classList.add("show-notes")}}function setInitialFuriganaState(){const e=document.getElementsByClassName("sentence");for(const t of e){const e=t.getElementsByTagName("rt");for(const t of e)t.style.visibility="hidden"}}function initializeEventListeners(){function e(){document.getElementById("graphContainer").style.display="none"}document.getElementById("toggleMode").addEventListener("click",(function(){document.body.classList.toggle("dark-mode"),document.body.classList.contains("dark-mode"),this.innerHTML='<i class="fa-solid fa-lightbulb"></i>'})),document.getElementById("container").addEventListener("click",toggleVisibility),document.getElementById("search").addEventListener("input",debounceSearch),document.addEventListener("click",(function(t){if(t.target.closest(".colouredNumber")){const n=t.target.closest(".colouredNumber").querySelector(".kanjiHeader");if(n){const t=n.textContent;document.getElementById("graphContainer").style.display="block",function(t){d3.select("#graphContainer").selectAll("*").remove();const n=d3.select("#graphContainer"),a=n.node().getBoundingClientRect().width,i=n.node().getBoundingClientRect().height,r=n.append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${a} ${i}`).call(d3.zoom().on("zoom",(e=>{o.attr("transform",e.transform)}))),o=r.append("g"),s=document.createElement("button");s.innerHTML="&times;",s.style.position="absolute",s.style.top="10px",s.style.right="10px",s.style.fontSize="20px",s.style.background="none",s.style.border="none",s.style.cursor="pointer",s.addEventListener("click",e);document.getElementById("graphContainer").appendChild(s);const{nodes:c,links:l}=function(e){let t=[],n=[];const a=kanjiData.find((t=>t.kanji===e));if(!a)return{nodes:t,links:n};const i={id:`kanji-${e}`,type:"kanji",label:e};return t.push(i),a.readings.forEach(((a,r)=>{const o={id:`reading-${e}-${r}`,type:"reading",label:a.reading,kanji:e,readingType:a.type};t.push(o),n.push({source:i.id,target:o.id,color:"kun"===a.type?"blue":"green"}),a.vocab.forEach(((i,s)=>{const c={id:`vocab-${e}-${r}-${s}`,type:"vocab",label:i};t.push(c),n.push({source:o.id,target:c.id,color:"kun"===a.type?"blue":"green"})}))})),{nodes:t,links:n}}(t),d=d3.forceSimulation(c).force("link",d3.forceLink(l).id((e=>e.id)).distance(100)).force("charge",d3.forceManyBody().strength(-400)).force("center",d3.forceCenter(a/2,i/2)).force("collide",d3.forceCollide().radius((e=>"kanji"===e.type?60:"reading"===e.type?40:30))),u=o.append("g").selectAll("line").data(l).enter().append("line").attr("class","arrow").attr("stroke",(e=>e.color)),g=o.append("g").selectAll("g").data(c).enter().append("g").call(d3.drag().on("start",m).on("drag",p).on("end",f));function h(){u.attr("x1",(e=>e.source.x)).attr("y1",(e=>e.source.y)).attr("x2",(e=>e.target.x)).attr("y2",(e=>e.target.y)),g.attr("transform",(e=>`translate(${e.x},${e.y})`))}function m(e,t){e.active||d.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y}function p(e,t){t.fx=e.x,t.fy=e.y}function f(e,t){e.active||d.alphaTarget(0),t.fx=null,t.fy=null}function y(){const e=n.node().getBoundingClientRect().width,t=n.node().getBoundingClientRect().height;r.attr("viewBox",`0 0 ${e} ${t}`),d.force("center",d3.forceCenter(e/2,t/2)),d.alpha(1).restart()}g.append("circle").attr("r",(e=>{let t=30;const n=5,a=c.filter((t=>t.type===e.type&&t.id!==e.id));if(a.length>0){const e=a.map((e=>e.x||0)),i=Math.min(...e),r=Math.max(...e);t=Math.max((r-i-n)/2,30)}return t})).attr("fill",(e=>"kanji"===e.type?"white":"reading"===e.type?(e.readingType,"white"):"white")).attr("stroke",(e=>"kanji"===e.type?"black":"reading"===e.type?"kun"===e.readingType?"blue":"green":"white")).attr("stroke-width",2),g.append("text").attr("class",(e=>"kanji"===e.type?"kanji":"reading"===e.type?`reading ${e.readingType}-reading`:"vocab")).attr("text-anchor","middle").attr("dominant-baseline","central").attr("dy","-0.1em").attr("fill",(e=>"kanji"===e.type?"black":"reading"===e.type?"kun"===e.readingType?"blue":"green":"black")).text((e=>e.label)),d.on("tick",h),window.addEventListener("resize",y)}(t)}}})),bindIME(),handleCheckboxChange();const{search:t,useLessons:n}=getQueryParams();if(t){const e=document.getElementById("search");e.value=t,e.dispatchEvent(new Event("input"))}const a=document.getElementById("useLessons");a.checked=n,a.dispatchEvent(new Event("change"))}const numberMapping={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九",10:"十"};let debounceTimer,reverseNumberMapping={};for(let e in numberMapping)reverseNumberMapping[numberMapping[e]]=e;function replaceNumbers(e){let t=e;return Object.keys(numberMapping).forEach((e=>{const n=numberMapping[e];t=t.replace(new RegExp(`\\b${e}\\b`,"g"),n)})),Object.keys(reverseNumberMapping).forEach((e=>{const n=reverseNumberMapping[e];t=t.replace(new RegExp(`\\b${e}\\b`,"g"),n)})),t}function prepareTextForSearch(e){const t=replaceNumbers(e);return{original:t,hiragana:wanakana.toHiragana(t),katakana:wanakana.toKatakana(t)}}function debounceSearch(){clearTimeout(debounceTimer),debounceTimer=setTimeout(searchFunction,300)}function debounceKanjiSearch(){clearTimeout(debounceTimer),debounceTimer=setTimeout(kanjiSearchFunction,300)}function searchFunction(){const e=document.getElementById("search").value.trim(),t=document.getElementById("kanjiFoundContainer");if(/^\s*$/.test(e))return filteredData=data,loadPage(1),void(t.innerHTML="");const n=[e].map((e=>prepareTextForSearch(replaceNumbers(e)))),a=document.getElementById("useKanji").checked,i=document.getElementById("useTranslation").checked,r=document.getElementById("useLessons").checked;if(a&&debounceKanjiSearch(),r)return void displayChapter(data);filteredData=[];let o=0;data.forEach((t=>{const s=document.createElement("div");s.innerHTML=t.exercise.sentence;const c=replaceNumbers(s.textContent.toLowerCase()),l=replaceNumbers(t.exercise.translation.toLowerCase());let d="";if(a){const e=s.getElementsByTagName("rt");d=Array.from(e).map((e=>replaceNumbers(e.textContent.toLowerCase()))).join(" ")}let u=!1;if(a||i||r)n.forEach((t=>{if(a&&(c.includes(t.hiragana)||c.includes(t.katakana))&&(u=!0),i){new RegExp(`\\b${e.toLowerCase()}\\b`,"i").test(l)&&(u=!0)}}));else{const e=s.getElementsByTagName("ruby");let t=s.textContent.toLowerCase();Array.from(e).forEach((e=>{const n=e.textContent;t=t.replace(n,e.childNodes[0].textContent)})),t=replaceNumbers(t),n.forEach((e=>{const n=e.hiragana+"|"+e.katakana;new RegExp(n,"g");(t.includes(e.hiragana)||t.includes(e.katakana))&&(u=!0)}))}u&&(filteredData.push(t),o++)})),loadPage(currentPage),updateCounter();const s=document.getElementsByClassName("exercise");let c=[];for(let t=0;t<s.length;t++){const o=s[t],l=o.getElementsByClassName("sentence")[0],d=o.getElementsByClassName("translation")[0];if(!l||!d)continue;const u=replaceNumbers(l.textContent.toLowerCase()),g=replaceNumbers(d.textContent.toLowerCase());let h="";if(a){const e=l.getElementsByTagName("rt");for(let t=0;t<e.length;t++)h+=replaceNumbers(e[t].textContent.toLowerCase())}let m=!1;if(a||i||r)n.forEach((t=>{a&&(u.includes(t.hiragana)||u.includes(t.katakana))&&(m=!0),i&&g.includes(e.toLowerCase())&&(m=!0)}));else{const e=l.cloneNode(!0),t=e.getElementsByTagName("rt");for(;t.length>0;)t[0].parentNode.removeChild(t[0]);const a=replaceNumbers(e.textContent.toLowerCase());n.forEach((e=>{(a.includes(e.hiragana)||a.includes(e.katakana))&&(m=!0)}))}m&&(c.push({element:l,text:u}),c.push({element:d,text:g}))}(a?highlightMatchesFuriganaKanji:highlightMatchesDefault)(c,n.flatMap((t=>[t.hiragana,t.katakana,e.toLowerCase()]))),document.getElementById("filteredNumber").innerText=o||"(•́︵•̀)"}function determineHighlightFunction(e,t){return e&&t?highlightMatchesFuriganaKanji:highlightMatchesDefault}function highlightMatchesDefault(e,t){e.forEach((({element:e})=>{let n=e.getAttribute("data-original-content")||e.innerHTML;const a=new RegExp(`(${t.join("|")})`,"gi"),i=t.map((e=>e.split("").map((e=>`<ruby>[^<]*${e}<rt[^>]*>[^<]*</rt></ruby>`)).join(""))).join("|");n=n.replace(a,'<span class="highlight">$1</span>');const r=new RegExp(`(${i})`,"gi");n=n.replace(r,'<span class="highlight">$1</span>'),n!==e.innerHTML&&(e.innerHTML=n),e.hasAttribute("data-original-content")||e.setAttribute("data-original-content",n)}))}function highlightMatchesFuriganaKanji(e,t){const n=document.getElementById("search").value,a=n.charAt(0),i=n.slice(1);e.forEach((({element:e})=>{e.querySelectorAll("ruby").forEach((e=>{const t=e.querySelector("rt");if(t){const n=t.textContent;3===e.childNodes[0].nodeType&&e.childNodes[0].nodeValue.trim()===a&&n===i?e.classList.add("highlight"):e.classList.remove("highlight")}}))}))}const kanjiSearchCache=new Map,kanjiOrderList=["日","一","ニ","三","十","四","五","六","七","八","九","丸","円","〇","人","百","千","万","口","田","目","川","月","明","曜","火","水","木","金","土","本","東","大","小","中","生","山","出","入","下","上","止","正","足","定","手","用","無","不","回","言","舌","話","活","行","心","耳","又","取","身","休","体","信","付","受","以","立","部","倍","成","代","王","玉","宝","国","白","皇","全","書","事","自","貝","見","力","刀","切","刃","分","公","別","長","男","女","子","好","安","案","字","学","父","文","交","校","母","毎","海","者","工","式","弐","武","糸","前","後","午","牛","年","件","条","化","花","北","比","背","車","気","汽","性","畑","青","麦","素","毒","先","洗","元","光","去","法","走","当","思","早","草","朝","潮","形","発","廃","音","意","作","昨","雨","電","頁","首","道","通","乳","豆","頭","予","矛","預","句","旬","勺","的","約","勿","物","方","防","面","画","両","岡","満","顔","産","同","向","尚","高","圧","地","池","他","集","進","込","斤","近","辺","最","皿","血","温","湿","爪","瓜","巾","布","市","吊","泉","原","源","線","綿","絹","錦","願","内","肉","猪","豚","家","吾","我","語","伝","転","芸","会","合","今","令","念","印","命","亡","米","粒","和","私","広","細","林","森","松","竹","都","京","政","府","戸","所","至","致","屋","室","古","居","局","故","胡","湖","固","箇","個","且","組","夕","外","多","汐","名","天","未","末","味","来","新","親","欠","次","席","度","渡","限","銀","根","良","郎","廊","食","飲","官","館","宿","犬","太","器","凶","区","図","番","号","品","楽","薬","周","週","調","束","整","数","類","示","禁","礼","社","申","神","員","質","党","堂","常","賞","償","掌","覚","悟","感","央","映","決","快","英","並","平","半","馬","尺","尽","駅","鳥","島","角","虫","触","解","独","店","占","点","士","商","買","売","続","読","共","供","洪","昔","冬","寒","春","夏","秋","主","住","駐","注","志","誌","仕","任","支","反","坂","阪","飯","返","雑","乱","寸","寺","時","持","特","待","得","侍","詩","即","節","筋","等","均","季","委","穴","空","友","有","左","右","石","若","苦","在","存","干","刊","汗","竿","利","害","益","溢","割","憲","羽","翌","習","弓","引","強","弱","風","己","記","紀","改","起","姓","由","油","井","囲","丼","丁","寧","町","灯","庁","貯","易","賜","場","湯","門","間","閉","開","関","問","聞","訪","送","券","包","巻","圏","勝","戦","単","簡","過","骨","昼","夜","液","戒","幾","畿","磯","機","械","飛","氏","民","紙","低","抵","邸","底","巨","臣","基","期","毛","尾","育","羊","洋","魚","鮮","蘇","詳","祥","美","業","実","養","様","企","曲","典","興","輿","竜","滝","籠","辰","農","濃","豊","吉","詰","結","投","役","没","設","段","殺","刹","刈","絵","給","巴","色","声","眉","里","理","埋","野","黒","墨","童","量","重","動","働","労","協","種","亜","悪","要","価","必","証","歪","否","処","拠","計","針","総","窓","矢","知","医","短","失","鉄","夫","朱","株","族","旅","遊","施","旋","旗","放","激","牧","位","泣","笑","専","恵","連","軍","運","蓮","隊","呈","程","聖","丑","紐","革","靴","鞄","皮","破","彼","波","果","課","巣","菓","茶","世","葉","棄","緑","録","剝","縁","介","界","浮","将","奨","状","病","症","痛","憶","臆","億","視","規","則","側","測","考","老","孝","厚","教","完","院","奈","宗","祭","際","察","祈","祖","助","仲","忠","沖","保","呆","守","団","対","村","才","財","材","沈","枕","丈","杖","偉","緯","衛","韓","違","抱","砲","泡","丹","舟","船","舶","般","搬","盤","歯","冷","齢","少","砂","歩","渉","省","相","想","称","弥","互","務","柔","軟","軌","軒","軸","較","庫","蔵","倉","創","告","造","衣","依","袋","褒","裏","表","現","著","制","製","初","裸","難","准","準","備","死","葬","列","烈","裂","例","刑","型","研","厄","危","範","怨","苑","宛","碗","腕","却","脚","犯","狂","獄","非","排","俳","罪","罰","伴","判","評","批","帥","師","座","坐","卒","率","傘","笠","星","汁","斗","料","科","然","燃","黙","獣","猟","漁","狩","猛","煙","焼","暁","旧","児","亦","赤","変","蛮","恋","愛","憂","優","栗","票","標","漂","遷","各","客","路","格","絡","略","閣","落","南","西","酉","酒","洒","配","酸","猶","尊","遵","導","敬","警","驚","散","敢","厳","仏","払","拡","可","何","苛","荷","河","阿","司","伺","詞","飼","冊","嗣","覗","歌","唄","負","敗","責","積","債","漬","紡","績","具","真","直","植","殖","値","置","県","州","洲","接","継","断","応","床","麻","歴","暦","臨","園","遠","与","写","移","卸","御","複","腹","復","往","柱","征","従","徒","縦","延","伸","紳","縮","誕","廷","庭","艇","展","殿","異","翼","累","塁","吏","使","史","更","便","硬","能","態","熊","罷","羅","雲","曇","雪","雷","零","震","振","久","賑","丘","兵","岳","浜","舎","再","虎","寅","演","黄","横","構","講","購","溝","仮","片","版","板","販","義","議","儀","犠","牲","旨","指","揮","輝","刺","策","差","着","看","到","倒","論","倫","輪","輸","諭","愉","癒","台","治","冶","療","僚","瞭","寮","始","終","了","承","蒸","舞","隣","瞬","夢","枝","技","伎","岐","峠","阜","急","争","情","清","晴","精","請","静","浄","算","答","符","博","縛","簿","薄","采","菜","採","彩","杉","街","術","述","余","除","徐","叙","斜","途","塗","漆","仙","垂","乗","兼","剰","睡","眠","郵","錘","華","侵","浸","寝","掃","婦","帰","戻","涙","射","謝","討","訂","打","撃","拭","試","検","験","険","倹","剣","谷","欲","浴","容","溶","俗","裕","寛","甘","紺","紅","攻","功","巧","朽","枯","汚","升","弁","昇","登","澄","充","銃","統","流","硫","盲","忘","忙","荒","慌","望","希","稀","括","拘","拾","捨","孤","弧","弾","禅","系","係","孫","懸","偏","遍","編","篇","普","譜","職","織","識","殉","退","眼","智","仁","忍","認","求","救","球","駐","純","鈍","召","招","沼","紹","詔","勅","昭","照","超","越","趣","赴","訃","朴","掛","摘","滴","嫡","適","敵","授","援","媛","緩","暖","観","勧","権","歓","鶴","確","慢","漫","卯","抑","仰","迎","柳","卵","疎","速","遅","辻","迅","加","減","滅","威","嚇","或","惑","域","収","納","献","貢","貪","貰","貧","賃","貸","貨","資","賛","替","潜","貿","留","溜","賀","架","染","梨","傑","貴","潰","遺","遣","追","迫","泊","伯","拍","弔","沸","煮","費","弟","第","剃","兄","只","税","鋭","説","脱","閲","祝","況","悦","克","競","姉","妹","珠","殊","序","秩","迭","喜","善","繕","膳","憾","恨","惜","措","借","錯","曽","増","層","憎","僧","贈","賄","賂","賦","賊","帯","滞","渋","摂","為","偽","参","惨","呂","侶","宮","営","蛍","栄","誉","挙","拳","桜","妥","咲","朕","茎","径","怪","軽","経","斉","斎","済","剤","剖","陪","培","賠","貼","粘","衡","換","喚","絶","免","逸","勉","晩","許","象","像","彫","景","影","撮","就","涼","鯨","隔","融","肖","消","硝","梢","削","宵","宴","郷","饗","響","城","誠","盛","旺","盆","蓋","盗","盟","塩","傷","揚","暢","陽","陰","隠","穏","穂","稲","愁","裁","載","栽","赦","跡","踪","痕","蹴","踊","踏","躍","濯","奇","寄","騎","椅","崎","埼","岬","模","膜","漠","幕","墓","募","暮","慕","添","恭","暴","爆","沿","礎","疑","凝","擬","倣","似","俵","俺","庵","僕","撲","叩","伐","閥","闘","闇","閑","脈","派","缶","揺","謡","遥","陶","陳","陣","陥","隆","降","峰","逢","縫","蜂","蜜","密","秘","欧","枢","殴","駆","馳","騒","旭","旦","但","担","亘","恒","垣","宣","喧","嘩","唾","壷","坪","畔","衆","伊","君","群","郡","那","邦","郊","効","絞","搾","紋","菊","帝","締","諦","享","郭","亭","停","昆","混","皆","楷","諧","階","陛","陸","睦","勢","熱","熟","塾","陵","菱","俊","唆","筈","箸","暑","署","曙","賭","諸","儲","緒","翁","婆","姿","恣","妄","萎","妻","凄","章","彰","障","辛","宰","辣","辞","壁","璧","癖","避","幸","服","報","執","摯","達","朗","浪","呉","娯","誤","富","副","幅","福","祉","禍","渦","鍋","蘭","欄","潤","淵","滑","稽","肩","脅","肯","双","江","湾","港","選","択","沢","訳","釈","敷","傲","贅","審","藩","翻","翔","査","租","粗","阻","狙","宜","畳","甲","乙","丙","柄","押","抽","捜","届","宙","笛","袖","襟","衿","裾","据","握","揃","撫","託","宅","詫","宇","芋","寿","鋳","銘","鏡","境","環","還","盾","循","巡","這","逓","息","憩","鼻","孔","臭","嗅","奥","尖","突","窒","窃","衝","契","喫","潔","侮","梅","悔","敏","繁","繋","茂","橋","矯","稿","縞","箋","残","桟","銭","践","浅","洩","壮","荘","装","冥","暗","韻","損","捕","挿","補","浦","哺","舗","掴","捉","促","筆","津","律","逮","建","健","康","庸","粛","繍","唐","糖","粧","糧","粉","紛","糾","粋","砕","枠","酔","醒","酬","酷","凡","凧","帆","汎","恐","怖","築","尋","訊","諮","抗","航","坑","拝","耕","耗","崇","灰","炭","岸","岩","崩","嵐","崖","催","焦","礁","奮","奪","隻","獲","穫","護","譲","嬢","醸","壌","壊","懐","徳","聴","恥","羞","爵","侯","喉","候","修","悠","是","提","堤","題","匙","冒","昌","唱","晶","帽","棟","凍","氷","永","泳","詠","札","枚","杯","析","折","挫","捻","誓","逝","哲","斬","漸","暫","斥","訴","訟","究","窮","極","函","探","深","慄","惧","慎","鎮","塡","婚","囚","困","梱","因","姻","咽","恩","菌","漢","嘆","勤","謹","僅","索","牽","牢","啓","庶","遮","燕","雀","劣","抄","秒","妙","沙","汰","煎","炒","炊","焚","薪","乃","之","此","其","乏","芝","及","扱","級","吸","吹","呼","吐","叶","叱","叫","吟","含","琴","迷","謎","逆","遡","塑","勲","薫","芳","香","秀","誘","拐","透","携","雄","雌","些","柴","紫","髪","髭","詐","欺","棋","碁","甚","勘","堪","匹","匠","匿","諾","乞","迄","乾","幹","操","燥","繰","藻","噴","墳","憤","牙","芽","雅","邪","既","概","慨","苗","描","猫","萌","兆","眺","逃","桃","跳","挑","拙","屈","掘","堀","封","筒","管","棺","轄","洞","窟","淫","妊","娠","唇","辱","襲","伏","吠","噛","班","斑","輩","悲","忽","惚","猿","哀","衰","衷","喪","忌","卓","悼","貞","偵","覇","覆","履","属","嘱","偶","隅","隙","遇","愚","曹","遭","槽","妨","坊","傍","於","房","扇","扉","雇","顧","屑","糞","尿","泌","尻","炉","窯","釜","爺","窪","佳","涯","暇","霞","雰","霧","露","霜","箱","籍","貫","慣","頂","戴","項","頃","傾","頑","頒","頓","顕","領","頻","捗","順","馴","訓","須","額","頼","瀬","峡","狭","挟","頰","顎","煩","串","患","疾","痴","疫","痢","痘","瘍","癌","痩","疲","被","披","抜","控","扶","抹","拓","拷","楼","壇","塔","搭","寡","賓","飾","飽","餓","飢","机","冗","冠","離","胸","悩","脳","臓","胃","炎","談","淡","災","肝","肺","胆","腺","胞","腸","胎","腰","肘","膝","股","肢","胴","脇","脂","詣","肪","肌","膚","慮","虐","虞","劇","虚","虜","勇","湧","戯","繊","緻","嘘","噂","樽","距","拒","嬉","鼓","樹","膨","脹","張","帳","腫","肥","把","誇","覧","監","鑑","艦","濫","藍","賢","腎","堅","緊","勃","励","栃","茨","羨","歳","戚","叔","淑","寂","督","奴","努","怒","隷","款","殻","穀","臼","毀","廉","鎌","嫌","謙","遜","亀","練","錬","鍛","鉱","銅","鉛","銑","鋼","剛","綱","網","縄","鉢","鎖","絆","鍵","釘","錮","錠","綻","鈴","鐘","瞳","憧","憬","卑","碑","痺","鬼","塊","醜","魂","魅","魔","畏","刷","擦","摩","磨","凹","凸","奉","奏","泰","俸","棒","捧","耐","霊","需","濡","儒","端","壱","尼","泥","漏","氾","彙","某","謀","媒","尉","慰","酪","酵","醤","酢","酎","酌","釣","畜","蓄","玄","眩","呟","囁","喋","喩","鬱","弦","舷","舵","幻","幽","幼","稚","維","推","堆","椎","脊","雛","誰","唯","鳴","亥","刻","劾","核","骸","咳","該","診","珍","瓦","併","瓶","屏","塀","餅","餌","呑","沃","妖","呪","艶","慈","滋","磁","擁","腐","芯","蒔","撒","撤","徹","微","徴","懲","殆","后","垢","妃","姫","如","茹","婿","娘","嫁","稼","塚","豪","蒙","墾","懇","貌","逐","遂","墜","堕","随","附","髄","怠","惰","佐","玩","弄","嘲","奔","弊","幣","蔽","朋","棚","柵","桁","栓","詮","塞","梗","柿","藤","騰","謄","麺","拉","晃","幌","厘","畝","匁","匂","勾","挨","拶","曖","昧","瑠","璃","嫉","妬","鹿","塵","麓","麗","薦","慶","兜","睨","鼠","溺","潟","濁","渇","褐","葛","喝","謁","掲","戌","尤","駄","駒","篤","罵","蔑","罠","烏","鴨","鳩","鶏","渓","鷹","鷲","璽","爽","綴","桑","蚕","蛋","蟹","蚊","巳","蛇","繭","蝶","虹"],worker=new Worker(URL.createObjectURL(new Blob(["\n    importScripts('https://unpkg.com/wanakana');\n\n    self.onmessage = function(e) {\n        const filteredDictionary = e.data;\n        const kanjiIndex = filteredDictionary.reduce((index, kanji) => {\n            const allReadings = kanji.kunyomi.concat(kanji.onyomi);\n            allReadings.forEach(reading => {\n                const hiragana = wanakana.toHiragana(reading);\n                if (!index[hiragana]) {\n                    index[hiragana] = [];\n                }\n                index[hiragana].push(kanji);\n            });\n            return index;\n        }, {});\n        self.postMessage(kanjiIndex);\n    };\n"],{type:"application/javascript"})));function kanjiSearchFunction(){const e=document.getElementById("search").value.trim().toLowerCase();if(kanjiSearchCache.has(e))return void renderResults(kanjiSearchCache.get(e));const t=window.kanjiIndex[e]||[];"まるばつ"===e&&t.push({literal:"〇"},{literal:"×"}),kanjiSearchCache.set(e,t),renderResults(t)}fetch("kanjiSubset-min.json").then((e=>e.json())).then((e=>{worker.postMessage(e)})).catch((e=>{})),worker.onmessage=function(e){window.kanjiIndex=e.data};const kanjiRanking=kanjiOrderList.reduce(((e,t,n)=>(e[t]=n,e)),{});function renderResults(e){const t=document.getElementById("kanjiFoundContainer");t.innerHTML="";const n=document.createDocumentFragment();e.sort(((e,t)=>(void 0!==kanjiRanking[e.literal]?kanjiRanking[e.literal]:1/0)-(void 0!==kanjiRanking[t.literal]?kanjiRanking[t.literal]:1/0))),e.forEach((e=>{const t=document.createElement("div");t.textContent=e.literal,t.className="kanji",t.addEventListener("click",(()=>{document.getElementById("search").value=e.literal,debounceSearch()})),n.appendChild(t)})),t.appendChild(n)}function bindIME(){const e=document.getElementById("search");wanakana.bind(e,{IMEMode:IMEMode}),isBound=!0}function unbindIME(){const e=document.getElementById("search");wanakana.unbind(e),isBound=!1}function toggleIMEMode(){IMEMode="toHiragana"===IMEMode?"toKatakana":"toHiragana",isBound&&bindIME()}function handleCheckboxChange(){document.getElementById("useKanji").checked;const e=document.getElementById("useTranslation").checked,t=document.getElementById("useLessons").checked;e||t?isBound&&unbindIME():isBound||bindIME(),searchFunction()}function clearElementHighlight(e){e&&e.hasAttribute("data-original-content")&&(e.innerHTML=e.getAttribute("data-original-content"),e.removeAttribute("data-original-content"))}function makeCheckboxesMutuallyExclusive(e){["useKanji","useTranslation","useLessons"].forEach((t=>{t!==e&&(document.getElementById(t).checked=!1)}))}function toggleVisibility(e){"RUBY"===e.target.tagName||e.target.closest("ruby")?handleRubyVisibility(e):e.target.classList.contains("close-note")?handleCloseNoteVisibility(e):e.target.classList.contains("notes")&&handleNotesVisibility(e)}function handleRubyVisibility(e){const t=e.target.closest("ruby").getElementsByTagName("rt");for(const e of t)e.style.visibility="hidden"===e.style.visibility?"visible":"hidden"}function handleCloseNoteVisibility(e){const t=e.target.closest(".notes");t.innerHTML="Show notes",t.classList.add("show-notes")}function handleNotesVisibility(e){const t=e.target,n=t.getAttribute("data-original-text");t.innerHTML=`${n} <span class="close-note">Close</span>`,t.classList.remove("show-notes")}function getQueryParams(){const e=new URLSearchParams(window.location.search);return{search:e.get("search"),useLessons:"true"===e.get("useLessons")}}function displayChapter(e){const t=document.getElementById("useLessons").checked,n=document.getElementById("search").value.trim();if(!t||""===n)return filteredData=e,void loadPage(1);const a=chapters[n];if(a){const t=parseInt(a.start_id),n=parseInt(a.end_id);filteredData=e.filter((e=>{const a=parseInt(e.id);return a>=t&&a<=n}))}else filteredData=[];loadPage(1),updateCounter()}